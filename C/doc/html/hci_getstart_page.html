<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>灵云SDK开发手册(C API): 简单示例</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">灵云SDK开发手册(C API)
   &#160;<span id="projectnumber">3.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li class="current"><a href="pages.html"><span>开发指南</span></a></li>
      <li><a href="modules.html"><span>API参考手册</span></a></li>
      <li><a href="annotated.html"><span>结构体</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hci_getstart_page.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全部</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>结构体</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>函数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>变量</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>类型定义</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>枚举值</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>组</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>页</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">简单示例 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>我们以使用HWR（手写识别）能力为例，看一下如何使用灵云系统。</p>
<h1><a class="anchor" id="hci_getstart_hci_init"></a>
1. 初始化灵云系统</h1>
<p>首先，我们需要初始化整个灵云系统。无论我们使用什么具体的能力，这一步都是必须的。</p>
<div class="fragment"><div class="line"><a class="code" href="group___h_c_i___s_y_s.html#ga9f643809ebea695fef3003df5d31b591">HCI_ERR_CODE</a> errCode;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">char</span> * pszConfig = </div>
<div class="line">        <span class="stringliteral">&quot;developerKey=01234567890,appKey=1234abcd,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;cloudUrl=http://api.hcicloud.com:9999,autoCloudAuth=no,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;authPath=document,&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;logFileSize=500,logLevel=5,logFilePath=document/log/,logFileCount=10&quot;</span>;</div>
<div class="line"></div>
<div class="line">errCode = <a class="code" href="group___h_c_i___s_y_s.html#gaaecd0af75009a2c0cacae0dde986eeb1" title="灵云系统SDK 公共初始化">hci_init</a>(pszConfig);</div>
<div class="line"><span class="keywordflow">if</span> (errCode != <a class="code" href="group___h_c_i___s_y_s.html#gga9f643809ebea695fef3003df5d31b591a8ba5db93033e78f0ff463777572c7018" title="0: 正确">HCI_ERR_NONE</a>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// 失败了</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>在使用时，需要将 developerKey, appKey, cloudUrl 这几项替换为由捷通分配给开发者的应用账号信息及云服务地址。 另外，需要确认authPath, logFilePath所指定的路径存在并且具有写权限。</p>
<p>如果 <a class="el" href="group___h_c_i___s_y_s.html#gaaecd0af75009a2c0cacae0dde986eeb1" title="灵云系统SDK 公共初始化">hci_init()</a> 函数返回 HCI_ERR_NONE，表示成功，否则表示失败。返回值不是 HCI_ERR_NONE 一般都表示失败， 可以根据具体返回值以及日志文件排查错误。下面的示例中也再不列出具体的错误检查代码。</p>
<h1><a class="anchor" id="hci_getstart_check_auth"></a>
2. 获取授权</h1>
<p>在灵云系统初始化成功后，第一次使用各项能力之前，我们还需要使用 <a class="el" href="group___h_c_i___s_y_s.html#ga432df9ea27c8eb63990424572179fa56" title="手动访问云授权">hci_check_auth()</a> 函数去云端获取授权。</p>
<div class="fragment"><div class="line">errCode = <a class="code" href="group___h_c_i___s_y_s.html#ga432df9ea27c8eb63990424572179fa56" title="手动访问云授权">hci_check_auth</a>();</div>
</div><!-- fragment --><p>从云端拿到的授权文件会缓存在 <a class="el" href="group___h_c_i___s_y_s.html#gaaecd0af75009a2c0cacae0dde986eeb1" title="灵云系统SDK 公共初始化">hci_init()</a> 时所提供的 authPath 路径下。以后使用会直接使用此文件， 不需要再到云端下载。但授权文件都有一个过期时间，一旦过期了，在一周的宽限期内，仍可以继续使用相应能力， 但超出宽限期，将无法再使用相应的能力。因此在过期时间到了之后必须及时到云端更新授权文件。 具体的更新方法请参见 <a class="el" href="hci_sys_intro_page.html#hci_sys_update_auth">更新授权文件</a> 。</p>
<h1><a class="anchor" id="hci_getstart_hwr_init"></a>
3. 初始化HWR能力</h1>
<p>如果使用手写识别能力，我们还需要初始化HWR能力引擎</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> * pszHwrInitConfig = <span class="stringliteral">&quot;dataPath=document/hwr,initCapKeys=hwr.local.freestylus&quot;</span>;</div>
<div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga6f0053ca26a6e81e03f9a2f4b7afefc5" title="灵云HWR能力 初始化">hci_hwr_init</a>(pszHwrInitConfig);</div>
</div><!-- fragment --><p>如果我们使用的是本地能力，需要用 initCapKeys 配置项指定在后面将会使用哪种本地能力。另外，还需要使用 dataPath 配置项指定本地资源（模型库文件）所在的路径。 这样系统会检查一下所用到的本地能力的资源是否完整可用。</p>
<p>如果使用的是云端能力，这里的配置串可以为空。</p>
<h1><a class="anchor" id="hci_getstart_hwr_session_start"></a>
4. 开启HWR识别会话</h1>
<p>在HWR能力初始化之后，需要通过开启识别会话来启用一种具体的能力，如下所示：</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> nSessionId = 0;</div>
<div class="line"><span class="keywordtype">char</span> * pszSessionConfig = <span class="stringliteral">&quot;capKey=hwr.local.freestylus&quot;</span>;</div>
<div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga94938645c0f1c3ba427614079205eef7" title="开始会话">hci_hwr_session_start</a>(pszSessionConfig, &amp;nSessionId);</div>
</div><!-- fragment --><p>示例中使用 capKey配置项指定了所要使用的能力为本地的连写识别引擎。 返回的 nSessionId 标识了此次会话，将来会使用此Id进行识别。</p>
<h1><a class="anchor" id="hci_getstart_hwr_recog"></a>
5. 识别</h1>
<div class="fragment"><div class="line"><span class="keywordtype">short</span> g_StrokeData[]=</div>
<div class="line">{</div>
<div class="line">        103 ,283 ,105 ,283 ,107 ,283 ,113 ,283 ,120 ,283,</div>
<div class="line">        129 ,283 ,138 ,283 ,146 ,283 ,156 ,283 ,162 ,283,</div>
<div class="line">        ...</div>
<div class="line">        -1 ,0 , -1, -1</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">char</span> * strRecogConfig = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a class="code" href="struct_h_w_r___r_e_c_o_g___r_e_s_u_l_t.html" title="HWR识别函数的返回结果">HWR_RECOG_RESULT</a> hwrRecogResult;</div>
<div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga61edb1a3697a3ace74701ff3802cc94e" title="识别函数">hci_hwr_recog</a>( nSessionId, g_StrokeData, <span class="keyword">sizeof</span>(g_StrokeData), pszRecogConfig, &amp;hwrRecogResult );</div>
</div><!-- fragment --><p>识别时，nSessionId 为上一步 <a class="el" href="group___h_c_i___h_w_r.html#ga94938645c0f1c3ba427614079205eef7" title="开始会话">hci_hwr_session_start()</a> 所返回的会话标识，g_StrokeData是笔迹数据, 由于没有特殊的识别配置项，pszRecogConfig这里设为空，识别后的返回结果将放在 hwrRecogResult 结构体中。</p>
<p>随后，我们打印结果：</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; hwrRecogResult.<a class="code" href="struct_h_w_r___r_e_c_o_g___r_e_s_u_l_t.html#a12969761398b9e0f6cfa11287fcb5099" title="识别候选结果的数目">uiResultItemCount</a>; ++i )</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="struct_h_w_r___r_e_c_o_g___r_e_s_u_l_t___i_t_e_m.html" title="HWR识别候选结果条目">HWR_RECOG_RESULT_ITEM</a>&amp; item = hwrRecogResult.phwrRecogResultItemList[i];</div>
<div class="line">        printf(<span class="stringliteral">&quot;result[%d]: %s\n&quot;</span>, i, item.<a class="code" href="struct_h_w_r___r_e_c_o_g___r_e_s_u_l_t___i_t_e_m.html#aab6f6f57e683e6a8d71dfb47bcbf9114" title="候选结果字符串，UTF-8编码，以&#39;\0&#39;结束(笔势识别时该字符串表示笔势识别结果的索引值，见笔势列表 )">pszResult</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>这里我们打印出了一次识别结果的多个候选内容。注意，我们的输出字符串内容都统一为 UTF8编码，因此在某些平台下输出可能需要转码操作，这里不做展示。</p>
<p>最后我们释放识别结果所占用的内存：</p>
<div class="fragment"><div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga5931d3e087442c9d5e935b120ebe6fde" title="释放识别结果内存">hci_hwr_free_recog_result</a>(&amp;hwrRecogResult);</div>
</div><!-- fragment --><p>这样，就完成了一次识别操作。在一个识别会话中，可以重复进行多次识别操作。</p>
<h1><a class="anchor" id="hci_getstart_hwr_session_stop"></a>
6. 关闭HWR识别会话</h1>
<p>不再需要使用某个识别会话后，需要关闭识别会话。</p>
<div class="fragment"><div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga4d2798117639a70725818427f4f0b301" title="结束会话">hci_hwr_session_stop</a>(nSessionId);</div>
</div><!-- fragment --><h1><a class="anchor" id="hci_getstart_hwr_release"></a>
7. 终止HWR能力</h1>
<p>如果所有的识别会话都已关闭，而且不需要再使用HWR能力了，我们可以终止HWR能力</p>
<div class="fragment"><div class="line">errCode = <a class="code" href="group___h_c_i___h_w_r.html#ga7d20476a18e3bcc384eb32636b0e2ebb" title="灵云HWR能力 反初始化">hci_hwr_release</a>();</div>
</div><!-- fragment --><h1><a class="anchor" id="hci_getstart_hci_release"></a>
8. 终止灵云系统</h1>
<p>最后，我们终止灵云系统。</p>
<div class="fragment"><div class="line">errCode = <a class="code" href="group___h_c_i___s_y_s.html#gab6358dadc2aa92c031f29685de2146c1" title="灵云系统SDK 反初始化">hci_release</a>();</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="hci_dev_content.html">开发指南</a></li>
    <li class="footer">生成于 2015年 七月 23日 星期四 17:55:40 , 为 灵云SDK开发手册(C API)使用 
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
